<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>2025 Product Roadmap – Param-Driven</title>

<!-- ─────────────────────────────────────────────────────────────
     ①  Fire Pipefy webhook on first load (if ?data= is absent)
     ②  Expect JSON  { "data": "<base-64-encoded-roadmap-json>" }
     ③  Reload page with ?data=<…> so the timeline logic below
         can decode and render the real roadmap.
     ──────────────────────────────────────────────────────────── -->
<script>
(async () => {
  const params = new URLSearchParams(location.search);
  if (params.has('data')) return;                        // already have payload, skip

  try {
    const resp = await fetch(
      'https://ipaas.pipefy.com/api/v1/webhooks/FX15MTvagDV7s4VM3gOVC',
      { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: '{}' }
    );
    if (!resp.ok) throw new Error(resp.statusText);

    const json = await resp.json();                      // expects { data: "<base64>" }
    if (!json.data) throw new Error('Webhook response missing “data” key');

    params.set('data', json.data);
    const newURL = location.origin + location.pathname + '?' + params.toString();
    location.replace(newURL);                            // reload with payload, no history entry
  } catch (err) {
    console.warn('⚠️  Webhook failed – using built-in demo data', err);
    /* fallback = defaultInitiatives further below */
  }
})();
</script>
<!-- ──────────────────────────────────────────────────────────── -->

<style>
/* ---------- Base layout ---------- */
body{margin:0;padding:32px;font-family:Arial,Helvetica,sans-serif;background:#f8f9fa}
h1  {margin-top:0;text-align:center}

/* ---------- Filter bar ---------- */
.filters{display:flex;flex-wrap:wrap;gap:24px;justify-content:center;margin-bottom:24px}
fieldset{border:1px solid #ced4da;border-radius:8px;padding:12px 16px}
legend  {font-weight:700;padding:0 4px}
label   {margin-right:12px;white-space:nowrap}

/* ---------- Month header ---------- */
.months{display:grid;grid-template-columns:150px repeat(12,1fr);margin-bottom:16px}
.months div:nth-child(1){}
.months div{background:#e9ecef;text-align:center;line-height:40px;font-weight:600;border-radius:4px}

/* ---------- Squad rows ---------- */
.squad-row{display:flex;align-items:flex-start;gap:8px;margin-bottom:20px;
           border-bottom:1px solid #e3e3e3;padding-bottom:12px}
.squad-row.hidden{display:none !important}
.squad-label{flex:0 0 150px;font-weight:700}
.lane{flex:1;position:relative;min-height:36px}

/* ---------- Initiative bars ---------- */
.item{position:absolute;height:36px;border-radius:20px;padding:6px 12px;color:#fff;
      font-size:0.9rem;white-space:nowrap;display:flex;align-items:center}
.squad-1{background:#FF6B6B}.squad-2{background:#6BCB77}.squad-3{background:#4D96FF}
.squad-4{background:#FFB84C}.squad-5{background:#845EC2}.squad-6{background:#00C9A7}
.squad-7{background:#FF9671}.squad-8{background:#2C73D2}

.hidden{display:none !important}
</style>
</head>
<body>

<h1>2025 Product Roadmap</h1>

<!-- ================= FILTER BAR ================= -->
<div class="filters">
  <fieldset id="squadFilter">
    <legend>Squads</legend>
    <label><input type="checkbox" value="1" checked> Squad&nbsp;1</label>
    <label><input type="checkbox" value="2" checked> Squad&nbsp;2</label>
    <label><input type="checkbox" value="3" checked> Squad&nbsp;3</label>
    <label><input type="checkbox" value="4" checked> Squad&nbsp;4</label>
    <label><input type="checkbox" value="5" checked> Squad&nbsp;5</label>
    <label><input type="checkbox" value="6" checked> Squad&nbsp;6</label>
    <label><input type="checkbox" value="7" checked> Squad&nbsp;7</label>
    <label><input type="checkbox" value="8" checked> Squad&nbsp;8</label>
  </fieldset>

  <fieldset id="quarterFilter">
    <legend>Quarters</legend>
    <label><input type="checkbox" value="Q1" checked> Q1&nbsp;(Jan–Mar)</label>
    <label><input type="checkbox" value="Q2" checked> Q2&nbsp;(Apr–Jun)</label>
    <label><input type="checkbox" value="Q3" checked> Q3&nbsp;(Jul–Sep)</label>
    <label><input type="checkbox" value="Q4" checked> Q4&nbsp;(Oct–Dec)</label>
  </fieldset>
</div>

<!-- ================= MONTH HEADER ================= -->
<div class="months">
  <div></div><div>Jan</div><div>Feb</div><div>Mar</div><div>Apr</div><div>May</div><div>Jun</div>
  <div>Jul</div><div>Aug</div><div>Sep</div><div>Oct</div><div>Nov</div><div>Dec</div>
</div>

<!-- ================= SQUAD ROWS ================= -->
<div id="rows"></div>

<script>
/* ---------- helper: decode ?data= ---------- */
function getDataFromURL(){
  const p=new URLSearchParams(location.search);
  if(!p.has('data')) return null;
  try{return JSON.parse(atob(p.get('data')));}catch(e){console.warn('Bad data param',e);return null;}
}

/* ---------- constants ---------- */
const BAR_H = 36, GAP = 16;
const t0=new Date('2025-01-01'), t1=new Date('2026-01-01');
const MS=86_400_000, timelineDays=(t1-t0)/MS;

/* ---------- fallback data ---------- */
const defaultSquadNames=[
  'Squad 1','Squad 2','Squad 3','Squad 4','Squad 5','Squad 6','Squad 7','Squad 8'
];
const defaultInitiatives=[
  {squad:1,label:'Login Revamp',start:'2025-01-05',end:'2025-02-19'},
  {squad:1,label:'SSO Integration',start:'2025-02-15',end:'2025-04-30'},
  {squad:1,label:'Mobile Auth',start:'2025-05-01',end:'2025-06-15'},
  {squad:2,label:'Billing System',start:'2025-01-20',end:'2025-03-31'},
  {squad:2,label:'Invoicing Automation',start:'2025-03-15',end:'2025-07-15'},
  {squad:3,label:'New Dashboard UI',start:'2025-02-01',end:'2025-04-15'},
  {squad:3,label:'Widget Customization',start:'2025-03-20',end:'2025-07-20'},
  {squad:3,label:'Theme Selector',start:'2025-07-21',end:'2025-10-15'}
];

/* ---------- load payload ---------- */
const payload=getDataFromURL();
const squadNames=payload?.squads??defaultSquadNames;
const initiatives=payload?.initiatives??defaultInitiatives;

/* ---------- build rows ---------- */
const rows=document.getElementById('rows');
for(let s=1;s<=8;s++){
  const row=document.createElement('div');
  row.className='squad-row';row.dataset.squad=s;
  const label=document.createElement('div');label.className='squad-label';
  label.textContent=squadNames[s-1]??`Squad ${s}`;
  const lane=document.createElement('div');lane.className='lane';lane.id=`lane-${s}`;
  row.append(label,lane);rows.appendChild(row);
}

/* helper */
const quartersBetween=(a,b)=>{const set=new Set(),d=new Date(a.getFullYear(),a.getMonth(),1);
  while(d<=b){set.add('Q'+(Math.floor(d.getMonth()/3)+1));d.setMonth(d.getMonth()+1);}
  return[...set];};

/* render bars */
initiatives.forEach(i=>{
  const s=new Date(i.start),e=new Date(i.end);
  const off=(s-t0)/MS,dur=(e-s)/MS+1;
  const bar=document.createElement('div');
  bar.className=`item squad-${i.squad}`;
  bar.style.left=`${100*off/timelineDays}%`;
  bar.style.width=`${100*dur/timelineDays}%`;
  bar.textContent=i.label;
  bar.dataset.squad=i.squad;
  bar.dataset.quarters=quartersBetween(s,e).join(',');
  bar.dataset.startOff=off;bar.dataset.endOff=off+dur;
  document.getElementById(`lane-${i.squad}`).appendChild(bar);
});

/* ---------- filter + wrap ---------- */
const squadBoxes=[...document.querySelectorAll('#squadFilter input')];
const quarterBoxes=[...document.querySelectorAll('#quarterFilter input')];
const bars=[...document.querySelectorAll('.item')];
const rowsAll=[...document.querySelectorAll('.squad-row')];

squadBoxes.forEach(cb=>cb.addEventListener('change',apply));
quarterBoxes.forEach(cb=>cb.addEventListener('change',apply));

function apply(){
  const activeS=squadBoxes.filter(cb=>cb.checked).map(cb=>cb.value);
  const activeQ=quarterBoxes.filter(cb=>cb.checked).map(cb=>cb.value);

  /* bar visibility */
  bars.forEach(b=>{
    const okS=activeS.includes(b.dataset.squad);
    const okQ=b.dataset.quarters.split(',').some(q=>activeQ.includes(q));
    b.classList.toggle('hidden',!(okS&&okQ));
  });

  /* wrap per squad */
  for(let s=1;s<=8;s++){
    const lane=document.getElementById(`lane-${s}`);
    const active=[...lane.querySelectorAll('.item:not(.hidden)')]
                 .sort((a,b)=>a.dataset.startOff-b.dataset.startOff);
    const ends=[];
    active.forEach(bar=>{
      const st=+bar.dataset.startOff,en=+bar.dataset.endOff;
      let idx=ends.findIndex(x=>x<st);
      if(idx===-1){idx=ends.length;ends.push(en);}else ends[idx]=en;
      bar.style.top=`${idx*(BAR_H+GAP)}px`;
    });
    lane.style.height=`${ends.length?ends.length*BAR_H+(ends.length-1)*GAP:BAR_H}px`;
  }

  /* row visibility */
  rowsAll.forEach(r=>{
    const any=[...r.querySelectorAll('.item')].some(b=>!b.classList.contains('hidden'));
    r.classList.toggle('hidden',!any);
  });
}

apply();
</script>
</body>
</html>
